make_temp_file() {
local filename
filename=$(mktemp --tmpdir /tmp/doit doit.tmp.XXX)
base64 /dev/urandom | head -c 100 > "$filename"
printf %s $filename
}

make_temp_dir() {
printf %s $(mktemp -d doit.tmp.XXX)
}

test_no_target_present () {
target_dir=$(make_temp_dir)
src=$(make_temp_file)
./doit $src $target_dir/foo
cmp $src $target_dir/foo; echo $?
}


test_target_is_a_regular_file () {
    target=$(make_temp_file)
    src=$(make_temp_file)
    ./doit $src $target
cmp $src $target; echo $?
}

test_target_is_a_symlink_to_a_different_file () {
diff_file=$(make_temp_file)
target=$(mktemp)
ln -fs $diff_file $target
src=$(make_temp_file)
./doit $src $target
cmp $src $target; echo $?
}

test_no_target_present
test_target_is_a_regular_file
test_target_is_a_symlink_to_a_different_file
 
